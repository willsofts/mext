(function(e){var f=38,j=40,i=13,d=27,k=115,h=32;var a=/[9XEATxea]/;e.widget("ui.xmllookup",{init:function(){var n=this;var m=this.applySetting(this.options,this.element);this.options.canLookup=m.canLookup;this.options.beforeLookup=m.beforeLookup;this.options.afterLookup=m.afterLookup;this.options.change=m.change;this.options.select=m.select;this.options.dialog=m.dialog;this.options.styles=m.styles;this.options.afterShow=m.afterShow;this.options.dynamicTag=m.dynamicTag;this.element.attr("readOnly",m.readOnly);function p(){n.hideList();e(document).unbind("click",p)}if(m.button){this.arrowElem=e(m.arrowHTML.call(this)).click(function(q){if(n.element.is(":disabled")){return false}if(!n.options.canLookup){return false}if(!n.options.beforeLookup(n)){return false}if(n.isListVisible()){}else{n.showList();e(document).click(p)}return false});this.element.after(this.arrowElem)}if(m.dialog){var o="fsccommboo"+Math.random();var l=e('<input type="text" id="'+o+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');e("body").append(l);this.listElem=this.buildList().insertAfter(l).hide()}else{this.listElem=this.buildList().insertAfter(this.element).hide()}if(m.autoShow){this.element.focus(b(this,"showList")).blur(function(q){n.finishSelection(n.selectedIndex,q);n.hideList()})}},_setOption:function(l,m){this.options[l]=m;if(l=="readOnly"){this.element.attr("readOnly",m)}},_init:function(){this.init.apply(this,arguments)},applySetting:function(o,n){var l=n.attr("id");var p=e('<IMG  align="absmiddle"  class="jrivaly lookupbuttonclass" SRC="../lookup/spacer.gif" ALT="">').mouseover(function(){e(this).addClass("ui-lookupbuttonclass-hover")}).mouseout(function(){e(this).removeClass("ui-lookupbuttonclass-hover")});this.fs_alink=e('<A href="#0" tabIndex="-1"  ID="LK'+l+'" style="cursor: pointer;" class="jrivaly lookup-link-class ui-combobox-link-class"></A>').bind("ondeactivate",function(){fs_rival_deactivate(l,this)}).bind("onbeforedeactivate",function(){fs_rival_beforedeactivate(l,this)});var m=jQuery.extend({data:[],dataMap:{},picture:"",xmldocs:null,singleShow:"both",autoShow:false,matchMiddle:true,readOnly:false,canLookup:true,button:true,styles:null,viewStyle:null,beforeLookup:function(){return true},afterLookup:function(r,q){return true},change:function(r,q){},select:function(r,q){},key:function(r,q){},arrowURL:"drop_down.png",arrowHTML:function(){return e(this.fs_alink).append(p)},onSelect:function(q,r){},afterShow:function(){},listContainerTag:"div",listHTML:c},o);return m},composeLookupDatas:function(q){var w=[];var t=this.options.xmldocs;if(t){var o=e(t).children();if(o.length>0){try{var l=t.documentElement;if(!l){l=t.parentNode}var n=l.getAttribute("type");if(n&&((n=="error")||(n=="none"))){return w}}catch(p){}if(o.children().length==0){return w}var r;var u="element";var s;var v=this.options.dynamicTag;if(v){r=e(v,t).get(0)}else{r=o.children()[0];if(t.parentNode){r=o[0]}v=r.nodeName}if(r){var m=e(r).children();if(m.length>0){u=m[0].nodeName;if(m.length>1){s=m[1].nodeName}}}e(v,t).each(function(z,A){var y=e(u,this).text();w.push(y);if(s){var x=e(s,this).text();q[y]=x}else{q[y]=y}})}}return w},composeXSL:function(p){var t="";var A=this.options.xmldocs;if(A){var r=e(A).children();if(r.length>0){try{var q=A.documentElement;if(!q){q=A.parentNode}var x=q.getAttribute("type");if(x&&((x=="error")||(x=="none"))){return t}}catch(B){}if(r.children().length==0){return t}var l=q.nodeName;var C;var E="element";var D;var s=this.options.dynamicTag;if(s){C=e(s,A).get(0)}else{C=r.children()[0];if(A.parentNode){C=r[0]}s=C.nodeName}if(C){var w="/"+C.nodeName;var z=C.parentNode;while(z&&(z.nodeName!=q.nodeName)){w="/"+z.nodeName+w;z=z.parentNode}l+=w;var n=e(C).children();if(n.length>0){E=n[0].nodeName;if(n.length>1){D=n[1].nodeName}}}var y=this.element;var m=this.options.afterLookup;window.choosedData=function(I,F){var G=I.getAttribute("itemcode");var H=I.getAttribute("itemdescription");y.val(G);if(m){m(G,H)}};var v=this.options.singleShow;var o="<\/script";var u=new String('<?xml version="1.0"?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"> ');u+='<xsl:template match="/"><table id="lookup" width="100%"  border="0" cellspacing="0" class="ui-state-default"> <xsl:for-each select="'+l+'"> <tr class="odd"> <xsl:if test="position() mod 2 = 0"><xsl:attribute name="class">event</xsl:attribute></xsl:if> <td class="elementline jrivaly ui-combobox-item" width="100%" style="cursor: pointer;" > <xsl:attribute name="itemcode"><xsl:value-of select="'+E+'"/></xsl:attribute>';if(D){u+='<xsl:attribute name="itemdescription"><xsl:value-of select="'+D+'"/></xsl:attribute>'}u+='<xsl:attribute name="onclick">choosedData(this,<xsl:value-of select="position() - 1"/>)</xsl:attribute> <div class="elementlayer" width="100%"> <a href="#" tabIndex="-1" ondragstart="return false;" class="jrivaly ui-combobox-item-link" style="white-space:nowrap; text-decoration: none; width:100%;" > ';if(!v){v="both"}if(v=="key"){u+='<xsl:value-of select="'+E+'"/> '}else{if(v=="value"&&D){u+='<xsl:value-of select="'+D+'"/>'}if(v=="both"){u+='<xsl:value-of select="'+E+'"/> ';if(D){u+=' - <xsl:value-of select="'+D+'"/>'}}}u=u+"</a> </div> </td> ";u=u+"</tr> </xsl:for-each> </table></xsl:template> </xsl:stylesheet> ";t=u}}return t},cleanup:function(){if(this.boundKeyHandler){e(document).unbind("keyup",this.boundKeyHandler)}if(this.arrowElem){this.arrowElem.remove()}this.listElem.remove()},destroy:function(){},getData:function(l){return this.composeXSL()},setData:function(m,n){this.options[m]=n;if(m=="disabled"&&this.isListVisible()){this.hideList()}if(m=="data"||m=="xmldocs"||m=="listContainerTag"||m=="listHTML"){var l=this.isListVisible();this.listElem=this.buildList().replaceAll(this.listElem);this[l?"showList":"hideList"]()}},buildTableList:function(){var o=this;var m=this.applySetting(this.options,this.element);var l=m.listContainerTag;var n=e("<"+l+' style="z-Index:1999999;" class = "jrivaly ui-combobox-list"></'+l+">");n.hover(function(){},function(){if(n.is(":visible")){o.hideList()}});return n},getDataCount:function(){var l=0;try{l=this.options.data.length}catch(m){}if(this.options.xmldocs){if(this.options.dynamicTag){var n=e(this.options.dynamicTag,this.options.xmldocs);l=n.length}else{var n=e(this.options.xmldocs).children();l=n.children().length}}return l},buildNormalList:function(){var p=this;var m=this.applySetting(this.options,this.element);var l=m.listContainerTag;var o=e("<"+l+' style="z-Index:1999999;" class = "jrivaly ui-combobox-list"></'+l+">");m.dataMap={};this.options.dataMap={};this.options.dataMap=m.dataMap;if(this.options.xmldocs){var n=e.parseXML(this.composeXSL());e(o).html(e.transform(this.options.xmldocs,n))}o.hover(function(){},function(){if(o.is(":visible")){p.hideList()}});return o},buildList:function(){if(this.listElem){this.listElem.empty()}return this.buildNormalList()},isListVisible:function(){return this.listElem.is(":visible")},showList:function(l){if(this.options.disabled){return}this.showNormalList(l)},showNormalList:function(q){var r=this.element.offset();var p=this.element.position();if(this.options.xmldocs){}var l=this.getDataCount();p.top+=this.element.height()+7;if(this.options.dialog){p.top=this.element.height();p.top=r.top+p.top;p.left=r.left}p.width=this.element.width()+5;p.position="absolute";p.overflow="auto";if(l>15){p.height=200;p.width=this.element.width()+20}var n=e(document.body);var o=n.innerHeight();var m=p.top+p.height;if(m>o){p.top=p.top-p.height-this.element.height()-7}if(this.options.styles){p.width=this.options.styles.width;if(this.options.styles.height){p.height=this.options.styles.height}}this.boundKeyHandler=b(this,"keyHandler");e(document).keyup(this.boundKeyHandler);e(".ui-combobox-list").hide();this.listElem.css(p).show();this.changeSelection(this.findSelection(),q);if(this.options.afterShow){this.options.afterShow()}},showTableList:function(l){},hideList:function(){this.listElem.hide();e(document).unbind("keyup",this.boundKeyHandler)},closeList:function(){hideList();if(this.arrowElem){this.arrowElem.remove()}this.listElem.remove()},keyHandler:function(o){if(this.options.disabled){return}try{var n=this.options.data.length;switch(o.which){case d:this.hideList();break;case f:var m=this.selectedIndex-1;if(m<0){m=n-1}this.changeSelection(m,o);break;case j:this.changeSelection((this.selectedIndex+1)%n,o);break;case h:case i:this.finishSelection(this.selectedIndex,o);break;default:this.fireEvent("key",o);this.changeSelection(this.findSelection());break}}catch(l){}},prepareCallbackObj:function(m){m=m||this.element.val();var l=e.inArray(m,this.options.data);return{value:m,index:l,isCustom:l==-1,inputElement:this.element,listElement:this.listElement}},fireEvent:function(l,n,o){var m=this.options[l];if(m){m(n,this.prepareCallbackObj(o))}},findSelection:function(){var o=this.options.data;var p=this.element.val().toLowerCase();if(o&&o.length>0){for(var n=0,l=o.length;n<l;++n){var m=o[n].toLowerCase().indexOf(p);if(m==0){return n}}if(this.options.matchMiddle){for(var n=0,l=o.length;n<l;++n){var m=o[n].toLowerCase().indexOf(p);if(m!=-1){return n}}}}return 0},changeSelection:function(l,m){this.selectedIndex=l;this.listElem.children(".selected").removeClass("selected");this.listElem.children(":eq("+l+")").addClass("selected");if(m){this.fireEvent("change",m,this.options.data[l])}},finishSelection:function(l,o){var n=this.options.data[l];this.element.val(n);this.hideList();this.fireEvent("select",o,n);var m=this.options.afterLookup;if(m){m(n,this.options.dataMap[n]||n)}}});e.fn.xmllookup.defaults={data:[],dataMap:{},picture:"",xmldocs:null,singleShow:false,autoShow:false,matchMiddle:true,readOnly:false,canLookup:true,beforeLookup:function(){return true},afterLookup:function(m,l){return true},change:function(m,l){},select:function(m,l){},key:function(m,l){},arrowURL:"drop_down.png",arrowHTML:function(){},listContainerTag:"div",listHTML:c,button:true};var g=e.fn.xmllookup;e.fn.xmllookup=function(m){var n=e("#LK"+e(this).attr("id"));if(!n.is(".ui-combobox-link-class")){n.remove()}var l=g.apply(this,arguments);if(!(l instanceof e)){return l}return l};function c(q,o,l,n,p){var r=q;if(!l&&n[q]){r+=" - "+n[q]}if("D"==p){r=n[q]}var m=o%2?"odd":"even";return'<span class = "jrivaly ui-combobox-item '+m+'" style="white-space:nowrap; ">'+r+"</span>"}function b(n,m){var l=[].slice.call(arguments,2);return function(){n[m].apply(n,l.concat([].slice.call(arguments)))}}})(jQuery);