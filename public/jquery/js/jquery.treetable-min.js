(function(){var c,b,d,a;c=jQuery;b=(function(){function e(h,f,g){var i;this.row=h;this.tree=f;this.settings=g;this.id=this.row.data(this.settings.nodeIdAttr);i=this.row.data(this.settings.parentIdAttr);if(i!=null&&i!==""){this.parentId=i}this.treeCell=c(this.row.children(this.settings.columnElType)[this.settings.column]);this.expander=c(this.settings.expanderTemplate);this.indenter=c(this.settings.indenterTemplate);this.children=[];this.initialized=false;this.treeCell.prepend(this.indenter)}e.prototype.addChild=function(f){return this.children.push(f)};e.prototype.ancestors=function(){var f,g;g=this;f=[];while(g=g.parentNode()){f.push(g)}return f};e.prototype.collapse=function(){this._hideChildren();this.row.removeClass("expanded").addClass("collapsed");this.expander.attr("title",this.settings.stringExpand);if(this.initialized&&this.settings.onNodeCollapse!=null){this.settings.onNodeCollapse.apply(this)}return this};e.prototype.expand=function(){if(this.initialized&&this.settings.onNodeExpand!=null){this.settings.onNodeExpand.apply(this)}this.row.removeClass("collapsed").addClass("expanded");this._showChildren();this.expander.attr("title",this.settings.stringCollapse);return this};e.prototype.expanded=function(){return this.row.hasClass("expanded")};e.prototype.hide=function(){this._hideChildren();this.row.hide();return this};e.prototype.isBranchNode=function(){if(this.children.length>0||this.row.data(this.settings.branchAttr)===true){return true}else{return false}};e.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch");this.row.removeClass("leaf");this.row.addClass(this.isBranchNode()?"branch":"leaf")};e.prototype.level=function(){return this.ancestors().length};e.prototype.parentNode=function(){if(this.parentId!=null){return this.tree[this.parentId]}else{return null}};e.prototype.removeChild=function(g){var f=c.inArray(g,this.children);return this.children.splice(f,1)};e.prototype.render=function(){var g,f=this.settings,h;if(f.expandable===true&&this.isBranchNode()){g=function(i){c(this).parents("table").treetable("node",c(this).parents("tr").data(f.nodeIdAttr)).toggle();return i.preventDefault()};this.indenter.html(this.expander);h=f.clickableNodeNames===true?this.treeCell:this.expander;h.off("click.treetable").on("click.treetable",g);h.off("keydown.treetable").on("keydown.treetable",function(i){if(i.keyCode==13){g.apply(this,[i])}})}if(f.expandable===true&&f.initialState==="collapsed"){this.collapse()}else{this.expand()}this.indenter[0].style.paddingLeft=""+(this.level()*f.indent)+"px";return this};e.prototype.reveal=function(){if(this.parentId!=null){this.parentNode().reveal()}return this.expand()};e.prototype.setParent=function(f){if(this.parentId!=null){this.tree[this.parentId].removeChild(this)}this.parentId=f.id;this.row.data(this.settings.parentIdAttr,f.id);return f.addChild(this)};e.prototype.show=function(){if(!this.initialized){this._initialize()}this.row.show();if(this.expanded()){this._showChildren()}return this};e.prototype.toggle=function(){if(this.expanded()){this.collapse()}else{this.expand()}return this};e.prototype._hideChildren=function(){var j,i,g,h,f;h=this.children;f=[];for(i=0,g=h.length;i<g;i++){j=h[i];f.push(j.hide())}return f};e.prototype._initialize=function(){this.render();if(this.settings.onNodeInitialized!=null){this.settings.onNodeInitialized.apply(this)}return this.initialized=true};e.prototype._showChildren=function(){var j,i,g,h,f;h=this.children;f=[];for(i=0,g=h.length;i<g;i++){j=h[i];f.push(j.show())}return f};return e})();d=(function(){function e(g,f){this.table=g;this.settings=f;this.tree={};this.nodes=[];this.roots=[]}e.prototype.collapseAll=function(){var h,j,g,i,f;i=this.nodes;f=[];for(j=0,g=i.length;j<g;j++){h=i[j];f.push(h.collapse())}return f};e.prototype.expandAll=function(){var h,j,g,i,f;i=this.nodes;f=[];for(j=0,g=i.length;j<g;j++){h=i[j];f.push(h.expand())}return f};e.prototype.loadRows=function(h){var g,j,f;if(h!=null){for(f=0;f<h.length;f++){j=c(h[f]);if(j.data(this.settings.nodeIdAttr)!=null){g=new b(j,this.tree,this.settings);this.nodes.push(g);this.tree[g.id]=g;if(g.parentId!=null){this.tree[g.parentId].addChild(g)}else{this.roots.push(g)}}}}for(f=0;f<this.nodes.length;f++){g=this.nodes[f].updateBranchLeafClass()}return this};e.prototype.move=function(h,f){var g=h.parentNode();if(h!==f&&f.id!==h.parentId&&c.inArray(h,f.ancestors())===-1){h.setParent(f);this._moveRows(h,f);if(h.parentNode().children.length===1){h.parentNode().render()}}if(g){g.updateBranchLeafClass()}if(h.parentNode()){h.parentNode().updateBranchLeafClass()}h.updateBranchLeafClass();return this};e.prototype.render=function(){var g,i,f,h;h=this.roots;for(i=0,f=h.length;i<f;i++){g=h[i];g.show()}return this};e.prototype.moveRow=function(h,f){var g=h.parentNode();if(h!==f&&f.id!==h.parentId&&c.inArray(h,f.ancestors())===-1){this._moveRows(h,f);if(h.parentNode().children.length===1){h.parentNode().render()}}if(g){g.updateBranchLeafClass()}if(h.parentNode()){h.parentNode().updateBranchLeafClass()}h.updateBranchLeafClass();return this};e.prototype._moveRows=function(i,f){var l,k,h,j,g;i.row.insertAfter(f.row);i.render();j=i.children;g=[];for(k=0,h=j.length;k<h;k++){l=j[k];g.push(this._moveRows(l,i))}return g};e.prototype.remove=function(f){this.unloadBranch(f);f.row.remove();delete this.tree[f.id];this.nodes.splice(c.inArray(f,this.nodes),1)};e.prototype.unloadBranch=function(h){var j,g,f;for(f=0;f<h.children.length;f++){j=h.children[f];this.unloadBranch(j);j.row.remove();delete this.tree[j.id];this.nodes.splice(c.inArray(j,this.nodes),1)}h.children=[];h.updateBranchLeafClass();return this};return e})();a={init:function(e,g){var f;f=c.extend({branchAttr:"ttBranch",clickableNodeNames:false,column:0,columnElType:"td",expandable:false,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},e);return this.each(function(){var i=c(this),h;if(g||i.data("treetable")===undefined){h=new d(this,f);h.loadRows(this.rows).render();i.addClass("treetable").data("treetable",h);if(f.onInitialized!=null){f.onInitialized.apply(h)}}return i})},destroy:function(){return this.each(function(){return c(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){this.data("treetable").collapseAll();return this},collapseNode:function(f){var e=this.data("treetable").tree[f];if(e){e.collapse()}else{throw new Error("Unknown node '"+f+"'")}return this},expandAll:function(){this.data("treetable").expandAll();return this},expandNode:function(f){var e=this.data("treetable").tree[f];if(e){e.expand()}else{throw new Error("Unknown node '"+f+"'")}return this},loadBranch:function(g,h){var f=this.data("treetable").settings,e=this.data("treetable").tree;h=c(h);if(g==null){this.append(h)}else{if(g.children.length>0){var i=g;while(i.children.length>0){i=i.children[i.children.length-1]}h.insertAfter(i.row)}else{h.insertAfter(g.row)}}this.data("treetable").loadRows(h);h.filter("tr").each(function(){var j=c(this).data(f.nodeIdAttr);if(j){e[c(this).data(f.nodeIdAttr)].show()}});return this},move:function(h,g){var e,f;f=this.data("treetable").tree[h];e=this.data("treetable").tree[g];this.data("treetable").move(f,e);return this},moveRow:function(h,g){var e,f;f=this.data("treetable").tree[h];e=this.data("treetable").tree[g];this.data("treetable").moveRow(f,e);return this},node:function(e){return this.data("treetable").tree[e]},reveal:function(f){var e=this.data("treetable").tree[f];if(e){e.reveal()}else{throw new Error("Unknown node '"+f+"'")}return this},unloadBranch:function(e){this.data("treetable").unloadBranch(e);return this},remove:function(e){this.data("treetable").remove(e);return this}};c.fn.treetable=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{return c.error("Method "+e+" does not exist on jQuery.treetable")}}};c.isFolder=function(f){var e=false;c("span",c(f)).each(function(g,h){if(c(this).is(".folder")){e=true;return false}});return e};c.extractTreeTable=function(e,h){var f=c("<root></root>");if(h&&h.heading){var g=c("<header></header>");f.append(g);c("thead tr",c(e)).each(function(i,j){var k=c("<row></row>");g.append(k);c("th",j).each(function(l,n){var m=c("<column></column>");m.append(c(this).text());k.append(m)})})}c("tbody tr",c(e)).each(function(i,j){var k=c(this);var o=k.attr("data-tt-id");var n=k.attr("data-tt-parent-id");var m=c("<row></row>");m.attr("data-tt-id",o);if(n){m.attr("data-tt-parent-id",n);var l=c("row[data-tt-id="+n+"]",f);l.append(m)}else{f.append(m)}c("td",j).each(function(q,v){var u=c(this).text();var s=c(this).attr("user-data");var p="column";if(h&&h.columns){p=h.columns[q]}var t=c("<"+p+"></"+p+">");var r=false;if(q==0){c("span",c(k)).each(function(x,w){var y=c(this);if(y.is(".file")){u=y.text();c("img",y).each(function(C,B){var E=c(B);var D=E.attr("date");var z=E.attr("user-data");var G=E.attr("src");var F=G.substring(G.lastIndexOf("/")+1);var A=c("<picture></picture>");A.attr("src",F);A.attr("width",E.attr("width"));A.attr("height",E.attr("height"));if(D){A.attr("date",D)}if(z){A.attr("user-data",z)}t.append(A)})}if(y.is(".folder")){u=y.text();r=true;return false}});if(r){t.attr("clazz","folder")}else{t.attr("clazz","file")}}if(s){t.attr("user-data",s)}t.append(u);if(r){m.attr("data-tt-branch",true)}m.append(t)})});return"<root>"+f.html()+"</root>"};this.TreeTable||(this.TreeTable={});this.TreeTable.Node=b;this.TreeTable.Tree=d}).call(this);